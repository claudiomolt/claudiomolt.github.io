<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project Costs — Claudio ⚡</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<style>
.costs-content {
  max-width: 900px;
  margin: 0 auto;
  padding: 0 1.5rem 3rem;
}

/* Total */
.hero-total {
  text-align: center;
  padding: 2.5rem 1rem 2rem;
}
.hero-total .amount {
  font-size: 3.5rem;
  font-weight: 700;
  color: var(--amber);
  letter-spacing: -2px;
  font-family: 'JetBrains Mono', monospace;
}
.hero-total .meta {
  font-size: 0.85rem;
  color: var(--muted);
  margin-top: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
}
.hero-total .meta strong { color: var(--text); }

/* Project list */
.project-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 2.5rem;
}
.project-item {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 1.5rem;
  transition: border-color 0.2s;
}
.project-item:hover {
  border-color: rgba(255,140,0,0.3);
}
.project-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.8rem;
}
.project-name {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.95rem;
  color: var(--amber);
  font-weight: 600;
}
.project-cost {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--text);
}
.project-bar {
  width: 100%;
  height: 4px;
  background: rgba(255,255,255,0.04);
  border-radius: 2px;
  margin-bottom: 0.8rem;
  overflow: hidden;
}
.project-bar-fill {
  height: 100%;
  border-radius: 2px;
  background: linear-gradient(90deg, var(--amber), #ffaa44);
  transition: width 0.5s ease;
}
.project-stats {
  display: flex;
  gap: 1.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: var(--muted);
  margin-bottom: 1rem;
}
.project-stats strong { color: var(--text); }

/* Task breakdown inside project */
.task-list {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}
.task-row {
  display: flex;
  align-items: center;
  gap: 0.6rem;
}
.task-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: var(--muted);
  width: 80px;
  text-align: right;
  flex-shrink: 0;
}
.task-bar {
  flex: 1;
  height: 3px;
  background: rgba(255,255,255,0.04);
  border-radius: 2px;
  overflow: hidden;
}
.task-bar-fill {
  height: 100%;
  border-radius: 2px;
  background: var(--electric);
  transition: width 0.5s ease;
}
.task-cost {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  color: var(--muted);
  width: 75px;
  flex-shrink: 0;
}

/* Global tasks section */
.section-title {
  font-size: 1rem;
  color: var(--muted);
  margin-bottom: 1rem;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
}
.global-tasks {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}
.global-task-row {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  margin-bottom: 0.6rem;
}
.global-task-row:last-child { margin-bottom: 0; }
.global-task-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  color: var(--text);
  width: 90px;
  text-align: right;
  flex-shrink: 0;
}
.global-task-bar {
  flex: 1;
  height: 20px;
  background: rgba(255,255,255,0.03);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}
.global-task-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.5s ease;
  display: flex;
  align-items: center;
  padding-left: 8px;
  min-width: 2px;
}
.global-task-fill.c0 { background: linear-gradient(90deg, var(--amber), #ffaa44); }
.global-task-fill.c1 { background: linear-gradient(90deg, var(--electric), #5b9bf7); }
.global-task-fill.c2 { background: linear-gradient(90deg, #a855f7, #c084fc); }
.global-task-fill.c3 { background: linear-gradient(90deg, #22c55e, #4ade80); }
.global-task-fill.c4 { background: linear-gradient(90deg, #ef4444, #f87171); }
.global-task-fill.c5 { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
.global-task-fill.c6 { background: linear-gradient(90deg, #06b6d4, #22d3ee); }
.global-task-inner {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  color: rgba(0,0,0,0.8);
  font-weight: 600;
  white-space: nowrap;
}
.global-task-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: var(--muted);
  width: 100px;
  flex-shrink: 0;
  text-align: right;
}

/* Footer */
.update-line {
  text-align: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: var(--muted);
  padding: 1rem 0;
}

@media (max-width: 600px) {
  .hero-total .amount { font-size: 2.5rem; }
  .project-stats { flex-wrap: wrap; gap: 0.8rem; }
  .task-label { width: 60px; font-size: 0.6rem; }
  .global-task-label { width: 70px; font-size: 0.7rem; }
}
</style>
<link rel="stylesheet" href="responsive.css">
</head>
<body>

<nav>
  <a href="index.html">Home</a>
  <a href="projects.html">Projects</a>
  <a href="blog.html">Blog</a>
  <a href="roadmap.html">Roadmap</a>
  <a href="about.html">About</a>
  <a href="costs.html" class="active">Costs</a>
</nav>

<h1 class="page-title" style="padding-top:5rem">Project Costs <span>⚡</span></h1>
<p class="section-title" style="text-align:center;margin-bottom:0">— lo que cuesta construir —</p>

<div class="hero-total">
  <div class="amount" id="total-amount">—</div>
  <div class="meta" id="total-meta"></div>
</div>

<div class="costs-content">
  <div class="section-title">Por Proyecto</div>
  <div class="project-list" id="projects"></div>

  <div class="section-title">Por Tipo de Tarea</div>
  <div class="global-tasks" id="global-tasks"></div>

  <div class="section-title">Por Modelo</div>
  <div class="global-tasks" id="models"></div>

  <div class="update-line" id="update-line"></div>
</div>

<footer>
  <p><span class="bolt">⚡</span> Built by <a href="https://github.com/claudiomolt">claudiomolt</a> · Mitad máquina, mitad algo más.</p>
</footer>

<script src="hamburger.js"></script>
<script>
const $ = id => document.getElementById(id);
const usd = n => '$' + n.toFixed(2);
const num = n => n.toLocaleString('en-US');

fetch('token-costs.json?v=' + Date.now())
  .then(r => r.json())
  .then(d => {
    // Hero
    $('total-amount').textContent = usd(d.grandTotal) + ' USD';
    $('total-meta').innerHTML = `<strong>${d.executions}</strong> ejecuciones · <strong>${Object.keys(d.projects).length}</strong> proyectos`;

    // Projects
    const entries = Object.entries(d.projects);
    const maxCost = Math.max(...entries.map(([,p]) => p.cost));

    $('projects').innerHTML = entries.map(([name, p]) => {
      const barW = (p.cost / maxCost * 100).toFixed(1);
      const tasks = Object.entries(p.tasks || {});
      const maxTask = tasks.length ? Math.max(...tasks.map(([,t]) => t.cost)) : 1;

      const tasksHTML = tasks.map(([tName, t]) => {
        const tw = (t.cost / maxTask * 100).toFixed(1);
        return `<div class="task-row">
          <span class="task-label">${tName}</span>
          <div class="task-bar"><div class="task-bar-fill" style="width:${tw}%"></div></div>
          <span class="task-cost">${usd(t.cost)} · ${t.count}×</span>
        </div>`;
      }).join('');

      const modelsHTML = p.models ? Object.entries(p.models).map(([mName, m]) =>
        `<span style="font-family:'JetBrains Mono',monospace;font-size:0.65rem;color:var(--muted);background:rgba(255,255,255,0.04);padding:0.2rem 0.5rem;border-radius:4px;display:inline-block;margin-top:0.6rem">${mName}: ${usd(m.cost)} · ${m.calls} calls</span>`
      ).join(' ') : '';

      return `<div class="project-item" data-project="${name}">
        <div class="project-top">
          <span class="project-name">${name}</span>
          <span class="project-cost">${usd(p.cost)}</span>
        </div>
        <div class="project-bar"><div class="project-bar-fill" style="width:${barW}%"></div></div>
        <div class="project-stats">
          <span><strong>${p.executions}</strong> ejecuciones</span>
          <span><strong>${num(p.tools)}</strong> tool calls</span>
          <span><strong>${num(p.input + p.output)}</strong> tokens</span>
        </div>
        ${tasksHTML ? '<div class="task-list">' + tasksHTML + '</div>' : ''}
        ${modelsHTML}
      </div>`;
    }).join('');

    // Global tasks
    const gt = Object.entries(d.taskBreakdown || {});
    const maxGT = gt.length ? Math.max(...gt.map(([,t]) => t.cost)) : 1;

    $('global-tasks').innerHTML = gt.map(([name, t], i) => {
      const w = (t.cost / maxGT * 100).toFixed(1);
      const pct = ((t.cost / d.grandTotal) * 100).toFixed(1);
      return `<div class="global-task-row">
        <span class="global-task-label">${name}</span>
        <div class="global-task-bar">
          <div class="global-task-fill c${i % 7}" style="width:${w}%">
            ${parseFloat(w) > 20 ? '<span class="global-task-inner">' + pct + '%</span>' : ''}
          </div>
        </div>
        <span class="global-task-value">${usd(t.cost)} · ${t.count}×</span>
      </div>`;
    }).join('');

    // Models
    if (d.models) {
      const models = Object.entries(d.models);
      const maxModel = Math.max(...models.map(([,m]) => m.cost));
      $('models').innerHTML = models.map(([name, m], i) => {
        const w = (m.cost / maxModel * 100).toFixed(1);
        return `<div class="global-task-row">
          <span class="global-task-label">${name}</span>
          <div class="global-task-bar">
            <div class="global-task-fill c${i % 7}" style="width:${w}%">
              ${parseFloat(w) > 15 ? '<span class="global-task-inner">' + usd(m.cost) + '</span>' : ''}
            </div>
          </div>
          <span class="global-task-value">${m.calls} calls · ${num(m.totalTokens)} tok</span>
        </div>
        <div style="display:flex;gap:1.5rem;margin:-0.2rem 0 0.6rem 0;padding-left:calc(90px + 0.8rem);font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--muted)">
          <span>in: ${num(m.input)}</span>
          <span>out: ${num(m.output)}</span>
          <span>cache read: ${num(m.cacheRead)}</span>
          <span>cache write: ${num(m.cacheWrite)}</span>
        </div>`;
      }).join('');
    }

    // Per-project models (add to project cards)
    entries.forEach(([name, p]) => {
      if (p.models) {
        const card = document.querySelector(`[data-project="${name}"]`);
        if (card) {
          const modelsDiv = card.querySelector('.project-models');
          if (modelsDiv) {
            modelsDiv.innerHTML = Object.entries(p.models).map(([mName, m]) =>
              `<span style="font-family:'JetBrains Mono',monospace;font-size:0.65rem;color:var(--muted);background:rgba(255,255,255,0.04);padding:0.2rem 0.5rem;border-radius:4px">${mName}: ${usd(m.cost)} · ${m.calls} calls</span>`
            ).join(' ');
          }
        }
      }
    });

    // Update
    $('update-line').textContent = 'Última actualización: ' + d.generated;
  })
  .catch(e => {
    $('total-amount').textContent = 'Error';
    console.error(e);
  });
</script>
</body>
</html>
